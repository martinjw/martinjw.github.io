<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ASP.Net Core Startup</title>
<link rel="stylesheet" type="text/css" href="../../../style.css" />
<script type="text/javascript" src="../../../utilities.js">
</script>
</head>
<body>
<h1>static void</h1>
<div class="menu">
<ul>
<li><a href="../../../index.html">Main &gt;</a></li>
<li><a href="../../dotnet.html">.Net &gt;</a></li>
<li><a href="../aspdotnet.html">ASP.Net &gt;</a></li>
<li><a href="core.html">DotNet Core</a></li>
<li><a href="mvc.html">MVC</a></li>
<li><a href="project.html">Core Project</a></li>
<li><a href="startup.html">Startup</a></li>
<li><a href="config.html">Config Settings</a></li>
<li><a href="iis.html">IIS</a></li>
<li><a href="controllers.html">Controllers</a></li>
<li><a href="views.html">Views</a></li>
<li><a href="di.html">Dependency Injection</a></li>
<li><a href="security.html">Security</a></li>
<li><a href="logging.html">Logging</a></li>
<li><a href="localization.html">Localization</a></li>
</ul>
</div>
<div class="content">
<h2>Startup</h2>

<h3>static void Main</h3>
<p>Asp.Net Core is a true console application, with a <span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:darkcyan;">Main</span>(<span style="color:blue;">string</span>[]&nbsp;args)</p>
<p>In RC1 it was in Startup.cs; from RC2 it is in Program.cs</p>
<div class="code">
<p><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">static</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:darkcyan;">Main</span>(<span style="color:blue;">string</span>[]&nbsp;args)<br/>
{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">var</span>&nbsp;host&nbsp;=&nbsp;new <span style="color:#2b91af;">WebHostBuilder</span>(args)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.UseKestrel()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.UseContentRoot(<span style="color:#2b91af;">Directory</span>.GetCurrentDirectory())<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.UseIISIntegration()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.UseStartup&lt;<span style="color:#2b91af;">Startup</span>&gt;()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Build();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;host.Run();<br/>
}</p>
</div>
<p>For Windows/IIS, you don't need to change this.</p>

<h3>Startup.cs</h3>
<p>In classic Asp.net, you configured things in Global.asax. In Core, you use Startup.cs</p>
<p>There is no base class or interface. The name and standard methods are conventions. You can have multiple "Startup" classes, but only one is used (either the project namespace, or it uses namespace alphabetical order(!)).</p>


<h3>Structure</h3>
<p>The minimum:</p>
<div class="code">
<p><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">Startup</span><br/>
{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//REQUIRED:&nbsp;configure&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;pipeline.</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:darkcyan;">Configure</span>(IApplicationBuilder&nbsp;app)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.Run(<span style="color:blue;">async</span>&nbsp;(context)&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">await</span>&nbsp;context.Response.WriteAsync(<span style="color:#a31515;">&quot;Hello&nbsp;:)&quot;</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
}</p>
</div>

<table>
<tr><td>Method</td><td>Notes</td><td>Arguments</td></tr>
<tr><td>Startup.<strong>Configure</strong>(IApplicationBuilder&nbsp;app, ...)</td>
<td>Required. Normally app.UseMvc()</td>
<td>IApplicationBuilder (required),<br/>
IHostingEnvironment, <br/>
ILoggerFactory</td>
</tr>
<tr><td>Startup.<strong>ConfigureServices</strong></td><td>(optional) build dependency injection</td>
<td>IServiceCollection (required, only input)</td></tr>
<tr><td>Constructor</td><td>Initial configuration, initialize "application" variables such as configuration</td>
<td>IHostingEnvironment, <br/>
ILoggerFactory</td>
</tr>
</table>
<p>IApplicationBuilder must only be used for Configure, and IServiceCollection must only be used for ConfigureServices</p>
<ul>
<li>IHostingEnvironment - EnvironmentName, WebRootPath, ContentRootPath</li>
<li>ILoggerFactory - used to hook up loggers</li>
</ul>

<div class="code">
<p><span style="color:blue;">public</span>&nbsp;<span style="color:blue;">class</span>&nbsp;<span style="color:#2b91af;">Startup</span><br/>
{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//keep&nbsp;thread-safe&nbsp;fields&nbsp;eg&nbsp;config</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">private</span>&nbsp;<span style="color:blue;">readonly</span>&nbsp;IConfiguration&nbsp;<span style="color:purple;">_configuration</span>;<br/>
 <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//constructor-&nbsp;eg&nbsp;reading&nbsp;config</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;Startup(IHostingEnvironment&nbsp;appEnv)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_configuration&nbsp;=&nbsp;<span style="color:blue;">new</span>&nbsp;ConfigurationBuilder()<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.AddJsonFile(<span style="color:#a31515;">&quot;config.json&quot;</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Build();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
 <br/>
 <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//&nbsp;Configure&nbsp;Dependency&nbsp;Injection</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:darkcyan;">ConfigureServices</span>(IServiceCollection&nbsp;services)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//EF</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;services.AddEntityFramework().AddSqlServer();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//MVC</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;services.AddMvc();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//local</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;services.AddTransient&lt;<span style="color:#2b91af;">IBusinessThing</span>,&nbsp;<span style="color:#2b91af;">BusinessThing</span>&gt;();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
 <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//REQUIRED:&nbsp;configure&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;pipeline.</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">public</span>&nbsp;<span style="color:blue;">void</span>&nbsp;<span style="color:darkcyan;">Configure</span>(IApplicationBuilder&nbsp;app,&nbsp;IHostingEnvironment&nbsp;env,&nbsp;ILoggerFactory&nbsp;loggerFactory)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//order&nbsp;is&nbsp;important-&nbsp;first&nbsp;is&nbsp;outermost&nbsp;(first/last),&nbsp;then&nbsp;we&nbsp;move&nbsp;in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loggerFactory.AddConsole();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">if</span>&nbsp;(env.IsDevelopment())<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.UseDeveloperExceptionPage();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.UseDatabaseErrorPage();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:blue;">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.UseExceptionHandler(<span style="color:#a31515;">&quot;/Home/Error&quot;</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.UseIISIntegration();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.UseStaticFiles();<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:green;">//if&nbsp;you&nbsp;don&#39;t&nbsp;configure&nbsp;routes,&nbsp;use&nbsp;attribute&nbsp;routing</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.UseMvc(routes&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;routes.MapRoute(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:darkblue;">name</span>:&nbsp;<span style="color:#a31515;">&quot;default&quot;</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:darkblue;">template</span>:&nbsp;<span style="color:#a31515;">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
}</p>
</div>

</div>
<div class="Footer"></div>
</body>
</html>
