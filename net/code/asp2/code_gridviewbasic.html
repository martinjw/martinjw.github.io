<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Basic GridView</title>
<link rel="stylesheet" type="text/css" href="../../../style.css" />
<script type="text/javascript" src="../../../utilities.js">
</script>
</head>
<body>
<h1>static void</h1>
<div class="menu">
<ul>
<li><a href="../../../index.html">Main</a></li>
<li><a href="../../dotnet.html">.Net</a></li>
<li><a href="../index.html">Code</a></li>
</ul>

</div>
<div class="content">
<h2>Basic GridView</h2>
<p>Binding an plain old CLR object list (or a DataTable, in comments) to a GridView with paging, sorting and editing.</p>
<h3>The page</h3>
<p>For paging and sorting only a plain gridview with BoundFields or autogenerated columns works fine- but for editing you need templated columns</p>
<div class="code">
<p><span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">GridView</span> <span style="color: red;">ID</span><span style="color: blue;">="GridView1"</span> <span style="color: red;">runat</span><span style="color: blue;">="server"</span> <span style="color: red;">AutoGenerateColumns</span><span style="color: blue;">="False"&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">Columns</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">TemplateField</span> <span style="color: red;">HeaderText</span><span style="color: blue;">="Name"</span> <span style="color: red;">SortExpression</span><span style="color: blue;">="Name"&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">EditItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">TextBox</span> <span style="color: red;">ID</span><span style="color: blue;">="txtName"</span> <span style="color: red;">runat</span><span style="color: blue;">="server"</span> <span style="color: red;">Text</span><span style="color: blue;">='</span><span style="background: #ffee62;">&lt;%</span># Bind("Name") <span style="background: #ffee62;">%&gt;</span><span style="color: blue;">'</span> <span style="color: blue;">/&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;/</span><span style="color: #a31515;">EditItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">ItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">Label</span> <span style="color: red;">ID</span><span style="color: blue;">="Label1"</span> <span style="color: red;">runat</span><span style="color: blue;">="server"</span> <span style="color: red;">Text</span><span style="color: blue;">='</span><span style="background: #ffee62;">&lt;%</span># Bind("Name") <span style="background: #ffee62;">%&gt;</span><span style="color: blue;">'</span> <span style="color: blue;">/&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;/</span><span style="color: #a31515;">ItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;/</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">TemplateField</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">TemplateField</span> <span style="color: red;">HeaderText</span><span style="color: blue;">="Date"</span> <span style="color: red;">SortExpression</span><span style="color: blue;">="Date"&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">EditItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">TextBox</span> <span style="color: red;">ID</span><span style="color: blue;">="txtDate"</span> <span style="color: red;">runat</span><span style="color: blue;">="server"</span> <span style="color: red;">Text</span><span style="color: blue;">='</span><span style="background: #ffee62;">&lt;%</span># Bind("Date", "{0:d}") <span style="background: #ffee62;">%&gt;</span><span style="color: blue;">'</span> <span style="color: blue;">/&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">CompareValidator</span> <span style="color: red;">ID</span><span style="color: blue;">="cvdate"</span> <span style="color: red;">runat</span><span style="color: blue;">="server"</span> <span style="color: red;">ControlToValidate</span><span style="color: blue;">="txtDate"</span> <span style="color: red;">ErrorMessage</span><span style="color: blue;">="Must be a date"</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: red;">Operator</span><span style="color: blue;">="DataTypeCheck"</span> <span style="color: red;">Type</span><span style="color: blue;">="Date"</span> <span style="color: blue;">/&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;/</span><span style="color: #a31515;">EditItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">ItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">Label</span> <span style="color: red;">ID</span><span style="color: blue;">="Label2"</span> <span style="color: red;">runat</span><span style="color: blue;">="server"</span> <span style="color: red;">Text</span><span style="color: blue;">='</span><span style="background: #ffee62;">&lt;%</span># Bind("Date", "{0:d}") <span style="background: #ffee62;">%&gt;</span><span style="color: blue;">'</span> <span style="color: blue;">/&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;/</span><span style="color: #a31515;">ItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;/</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">TemplateField</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">TemplateField</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">ItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">Button</span> <span style="color: red;">runat</span><span style="color: blue;">="server"</span> <span style="color: red;">ID</span><span style="color: blue;">="btnClick"</span> <span style="color: red;">Text</span><span style="color: blue;">="Date to Today"</span> <span style="color: red;">CommandName</span><span style="color: blue;">="SetToday"</span> <span style="color: red;">CommandArgument</span><span style="color: blue;">='</span><span style="background: #ffee62;">&lt;%</span># ((GridViewRow) Container).RowIndex <span style="background: #ffee62;">%&gt;</span><span style="color: blue;">'/&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;/</span><span style="color: #a31515;">ItemTemplate</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;/</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">TemplateField</span><span style="color: blue;">&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">&lt;/</span><span style="color: #a31515;">Columns</span><span style="color: blue;">&gt;</span><br />
<span style="color: blue;">&lt;/</span><span style="color: #a31515;">asp</span><span style="color: blue;">:</span><span style="color: #a31515;">GridView</span><span style="color: blue;">&gt;</span></p>
</div>

<h3>The code behind:</h3>

<div class="code">
<p><span style="color: blue;">using</span> System;<br />
<span style="color: blue;">using</span> System.Collections.Generic;<br />
<span style="color: blue;">using</span> System.Data;<br />
<span style="color: blue;">using</span> System.Drawing;<br />
<span style="color: blue;">using</span> System.Web.UI;<br />
<span style="color: blue;">using</span> System.Web.UI.WebControls;<br />
&nbsp;<br />
<span style="color: blue;">public</span> <span style="color: blue;">partial</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">TestGrid</span> : <span style="color: #2b91af;">Page</span><br />
{<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">protected</span> <span style="color: blue;">void</span> Page_Load(<span style="color: blue;">object</span> sender, <span style="color: #2b91af;">EventArgs</span> e)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; AttachEvents();<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (!IsPostBack)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StoredData = LoadDatedItems();<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SetupGridView();<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.DataSource = StoredData;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.DataBind();<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> Initialize the grid view or put these as attributes</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> SetupGridView()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; AllowSortingAndPaging(GridView1);<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//for editing</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.DataKeyNames = <span style="color: blue;">new</span> <span style="color: blue;">string</span>[] { <span style="color: #a31515;">"Id"</span> }; <span style="color: green;">//customize this</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.AutoGenerateSelectButton = <span style="color: blue;">true</span>;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.AutoGenerateEditButton = <span style="color: blue;">true</span>;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">static</span> <span style="color: blue;">void</span> AllowSortingAndPaging(<span style="color: #2b91af;">GridView</span> gv)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.AllowPaging = <span style="color: blue;">true</span>;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.AllowSorting = <span style="color: blue;">true</span>;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.PageSize = 20; <span style="color: green;">//if you edit and turn off paging, this gets killed</span><br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> Bind events every postback, or put these as attributes</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> AttachEvents()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.Sorting += GridView1_Sorting;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.PageIndexChanging += GridView1_PageIndexChanging;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//for editing</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.RowCommand += GridView1_RowCommand;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.RowEditing += GridView1_RowEditing;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.RowUpdating += GridView1_RowUpdating;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.RowCancelingEdit += GridView1_RowCancelingEdit;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
<span style="color: blue;">&nbsp;&nbsp;&nbsp; #region</span> GridView events<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> GridView1_PageIndexChanging(<span style="color: blue;">object</span> sender, <span style="color: #2b91af;">GridViewPageEventArgs</span> e)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">GridView</span> gv = (<span style="color: #2b91af;">GridView</span>)sender;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.PageIndex = e.NewPageIndex; <span style="color: green;">//simply set the page</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.DataSource = StoredData; <span style="color: green;">//rebind to stored data</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataBind();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> GridView1_Sorting(<span style="color: blue;">object</span> sender, <span style="color: #2b91af;">GridViewSortEventArgs</span> e)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">GridView</span> gv = (<span style="color: #2b91af;">GridView</span>)sender;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.PageIndex = 0; <span style="color: green;">//always sort to page 1</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GetSortDirection(e.SortExpression); <span style="color: green;">//sort direction is always ascending, so we do this manually</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridViewSortBy = e.SortExpression; <span style="color: green;">//sortBy is stored so we can change direction next time</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SortData(); <span style="color: green;">//for a poco, you must hardcode the mapping to the properties</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridView1.DataSource = StoredData; <span style="color: green;">//rebind to stored data</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataBind();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> GetSortDirection(<span style="color: blue;">string</span> sortBy)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//swap the sort direction if sorting same column</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (GridViewSortBy != sortBy)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridViewSortAscending = <span style="color: blue;">true</span>;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GridViewSortAscending = !GridViewSortAscending;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> GridView1_RowCommand(<span style="color: blue;">object</span> sender, <span style="color: #2b91af;">GridViewCommandEventArgs</span> e)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">GridView</span> gv = (<span style="color: #2b91af;">GridView</span>)sender;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//NB this is also fired by Paging, Sorting, Editing etc... </span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (e.CommandName.Equals(<span style="color: #a31515;">"Select"</span>, <span style="color: #2b91af;">StringComparison</span>.OrdinalIgnoreCase))<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SelectCommand(e.CommandArgument, gv);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (e.CommandName.Equals(<span style="color: #a31515;">"SetToday"</span>, <span style="color: #2b91af;">StringComparison</span>.OrdinalIgnoreCase))<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; TodayCommand(e.CommandArgument, gv);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">static</span> <span style="color: blue;">int</span> GetKeyFromDataKeys(<span style="color: #2b91af;">GridView</span> gv, <span style="color: blue;">int</span> rowIndex)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//assumes key is an integer first in DataKeys. Adjust for strings or multiple IDs.</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (rowIndex &lt;= gv.DataKeys.Count)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> (<span style="color: blue;">int</span>)gv.DataKeys[rowIndex][0];<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> -1; <span style="color: green;">//might throw an error here</span><br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">static</span> <span style="color: blue;">void</span> SelectCommand(<span style="color: blue;">object</span> commandArgument, <span style="color: #2b91af;">GridView</span> gv)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//a templated field may shortcircuit with the key (Eval("Id")) but you won't get the row</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> rowIndex = <span style="color: #2b91af;">Convert</span>.ToInt32(commandArgument);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">GridViewRow</span> row = gv.Rows[rowIndex];<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//int key = GetKeyFromDataKeys(gv, rowIndex); //if needed</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; row.BackColor = <span style="color: #2b91af;">Color</span>.AliceBlue;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> TodayCommand(<span style="color: blue;">object</span> commandArgument, <span style="color: #2b91af;">GridView</span> gv)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> rowIndex = <span style="color: #2b91af;">Convert</span>.ToInt32(commandArgument);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//GridViewRow row = gv.Rows[rowIndex];</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> key = GetKeyFromDataKeys(gv, rowIndex);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SetDateToToday(key);<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataSource = StoredData; <span style="color: green;">//rebind</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataBind();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> GridView1_RowEditing(<span style="color: blue;">object</span> sender, <span style="color: #2b91af;">GridViewEditEventArgs</span> e)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">GridView</span> gv = (<span style="color: #2b91af;">GridView</span>)sender;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//to get index and row</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//int rowIndex = e.NewEditIndex; //here we have the row directly</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//GridViewRow row = gv.Rows[rowIndex];</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.EditIndex = e.NewEditIndex;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//you must rebind</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataSource = StoredData;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataBind();<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//important - turn off paging and sorting </span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//(do this after binding, unlike in updating and canceledit)</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.AllowPaging = <span style="color: blue;">false</span>;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.AllowSorting = <span style="color: blue;">false</span>;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> GridView1_RowCancelingEdit(<span style="color: blue;">object</span> sender, <span style="color: #2b91af;">GridViewCancelEditEventArgs</span> e)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">GridView</span> gv = (<span style="color: #2b91af;">GridView</span>)sender;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.EditIndex = -1;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//turn back on paging and sorting</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; AllowSortingAndPaging(GridView1);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//you must rebind last of all</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataSource = StoredData;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataBind();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> GridView1_RowUpdating(<span style="color: blue;">object</span> sender, <span style="color: #2b91af;">GridViewUpdateEventArgs</span> e)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">GridView</span> gv = (<span style="color: #2b91af;">GridView</span>)sender;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//to get index and row</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> rowIndex = e.RowIndex; <span style="color: green;">//here we have the row directly</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">GridViewRow</span> row = gv.Rows[rowIndex]; <span style="color: green;">//the row</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GetDataFromEventArgs(e); <span style="color: green;">//this won't work here (for reference only)</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; GetDataFromTemplatedRow(gv, rowIndex, row); <span style="color: green;">//use FindControl</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.EditIndex = -1;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//turn back on paging and sorting</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; AllowSortingAndPaging(GridView1);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//you must rebind last of all</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataSource = StoredData;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; gv.DataBind();<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">static</span> <span style="color: blue;">string</span> GetTextBoxText(<span style="color: #2b91af;">Control</span> row, <span style="color: blue;">string</span> Id)<br />
&nbsp;&nbsp;&nbsp; { <span style="color: green;">//helper to get the text from a textbox in a gridrow</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">TextBox</span> txtName = row.FindControl(Id) <span style="color: blue;">as</span> <span style="color: #2b91af;">TextBox</span>;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (txtName != <span style="color: blue;">null</span>) <span style="color: blue;">return</span> txtName.Text;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span> <span style="color: blue;">return</span> <span style="color: #2b91af;">String</span>.Empty;<br />
&nbsp;&nbsp;&nbsp; }<br />
<span style="color: blue;">&nbsp;&nbsp;&nbsp; #endregion</span><br />
&nbsp;<br />
<span style="color: blue;">&nbsp;&nbsp;&nbsp; #region</span> Properties storing GridView data and settings<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">bool</span> GridViewSortAscending<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> (ViewState[<span style="color: #a31515;">"SortDirection"</span>] == <span style="color: blue;">null</span>) ? <span style="color: blue;">true</span> : (<span style="color: blue;">bool</span>)ViewState[<span style="color: #a31515;">"SortDirection"</span>]; }<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">set</span> { ViewState[<span style="color: #a31515;">"SortDirection"</span>] = <span style="color: blue;">value</span>; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">string</span> GridViewSortBy<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> ViewState[<span style="color: #a31515;">"SortBy"</span>] <span style="color: blue;">as</span> <span style="color: blue;">string</span> ?? <span style="color: #a31515;">""</span>; }<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">set</span> { ViewState[<span style="color: #a31515;">"SortBy"</span>] = <span style="color: blue;">value</span>; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
<span style="color: blue;">&nbsp;&nbsp;&nbsp; #endregion</span><br />
&nbsp;<br />
&nbsp;<br />
<span style="color: blue;">&nbsp;&nbsp;&nbsp; #region</span> Alter to fit data type<br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> Generates some dummy data</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">static</span> <span style="color: #2b91af;">List</span>&lt;<span style="color: #2b91af;">DatedItem</span>&gt; LoadDatedItems()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">List</span>&lt;<span style="color: #2b91af;">DatedItem</span>&gt; items = <span style="color: blue;">new</span> <span style="color: #2b91af;">List</span>&lt;<span style="color: #2b91af;">DatedItem</span>&gt;();<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">for</span> (<span style="color: blue;">int</span> i = 0; i &lt; 30; i++)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">DatedItem</span> di = <span style="color: blue;">new</span> <span style="color: #2b91af;">DatedItem</span>();<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; di.Date = <span style="color: #2b91af;">DateTime</span>.Now.AddDays(-i);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; di.Id = i;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; di.Name = di.Date.ToString(<span style="color: #a31515;">"MMMM dd"</span>);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; items.Add(di);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> items;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;">&nbsp; Sorts the data manually</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> SortData()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (GridViewSortBy.Equals(<span style="color: #a31515;">"Name"</span>, <span style="color: #2b91af;">StringComparison</span>.OrdinalIgnoreCase))<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (GridViewSortAscending)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StoredData.Sort(<span style="color: blue;">delegate</span>(<span style="color: #2b91af;">DatedItem</span> p1, <span style="color: #2b91af;">DatedItem</span> p2)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; { <span style="color: blue;">return</span> p1.Name.CompareTo(p2.Name); });<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StoredData.Sort(<span style="color: blue;">delegate</span>(<span style="color: #2b91af;">DatedItem</span> p1, <span style="color: #2b91af;">DatedItem</span> p2)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; { <span style="color: blue;">return</span> -p1.Name.CompareTo(p2.Name); });<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span> <span style="color: blue;">if</span> (GridViewSortBy.Equals(<span style="color: #a31515;">"Id"</span>, <span style="color: #2b91af;">StringComparison</span>.OrdinalIgnoreCase))<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (GridViewSortAscending)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StoredData.Sort(<span style="color: blue;">delegate</span>(<span style="color: #2b91af;">DatedItem</span> p1, <span style="color: #2b91af;">DatedItem</span> p2)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; { <span style="color: blue;">return</span> p1.Id.CompareTo(p2.Id); });<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StoredData.Sort(<span style="color: blue;">delegate</span>(<span style="color: #2b91af;">DatedItem</span> p1, <span style="color: #2b91af;">DatedItem</span> p2)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; { <span style="color: blue;">return</span> -p1.Id.CompareTo(p2.Id); });<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span> <span style="color: blue;">if</span> (GridViewSortBy.Equals(<span style="color: #a31515;">"Date"</span>, <span style="color: #2b91af;">StringComparison</span>.OrdinalIgnoreCase))<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (GridViewSortAscending)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StoredData.Sort(<span style="color: blue;">delegate</span>(<span style="color: #2b91af;">DatedItem</span> p1, <span style="color: #2b91af;">DatedItem</span> p2)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; { <span style="color: blue;">return</span> p1.Date.CompareTo(p2.Date); });<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">else</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StoredData.Sort(<span style="color: blue;">delegate</span>(<span style="color: #2b91af;">DatedItem</span> p1, <span style="color: #2b91af;">DatedItem</span> p2)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; { <span style="color: blue;">return</span> -p1.Date.CompareTo(p2.Date); });<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: #2b91af;">List</span>&lt;<span style="color: #2b91af;">DatedItem</span>&gt; StoredData<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> ViewState[<span style="color: #a31515;">"StoredData"</span>] <span style="color: blue;">as</span> <span style="color: #2b91af;">List</span>&lt;<span style="color: #2b91af;">DatedItem</span>&gt; ?? LoadDatedItems(); }<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">set</span> { ViewState[<span style="color: #a31515;">"StoredData"</span>] = <span style="color: blue;">value</span>; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> GetDataFromTemplatedRow(<span style="color: #2b91af;">GridView</span> gv, <span style="color: blue;">int</span> rowIndex, <span style="color: #2b91af;">Control</span> row)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//you MUST use templated columns (you should anyway to validate), so use FindControl</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">string</span> name = GetTextBoxText(row, <span style="color: #a31515;">"txtName"</span>);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">string</span> date = GetTextBoxText(row, <span style="color: #a31515;">"txtDate"</span>);<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> key = (<span style="color: blue;">int</span>)gv.DataKeys[rowIndex][0];<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; UpdateData(key, name, date);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> GetDataFromEventArgs(<span style="color: #2b91af;">GridViewUpdateEventArgs</span> e)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//autogenerated columns tied to an object (not a datasource) don't work here.</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (e.Keys.Count &gt; 0)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> key = (<span style="color: blue;">int</span>)e.Keys[0]; <span style="color: green;">//if using DataKeys</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">DatedItem</span> di = StoredData.Find(<span style="color: blue;">delegate</span>(<span style="color: #2b91af;">DatedItem</span> d) { <span style="color: blue;">return</span> (d.Id == key); });<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (di != <span style="color: blue;">null</span>)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; di.Name = (<span style="color: blue;">string</span>)e.NewValues[<span style="color: #a31515;">"Name"</span>];<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> UpdateData(<span style="color: blue;">int</span> key, <span style="color: blue;">string</span> name, <span style="color: blue;">string</span> date)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">DatedItem</span> di = StoredData.Find(<span style="color: blue;">delegate</span>(<span style="color: #2b91af;">DatedItem</span> d) { <span style="color: blue;">return</span> (d.Id == key); });<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (di == <span style="color: blue;">null</span>) <span style="color: blue;">return</span>;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; di.Name = name;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; di.Date = <span style="color: #2b91af;">Convert</span>.ToDateTime(date);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">void</span> SetDateToToday(<span style="color: blue;">int</span> key)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: #2b91af;">List</span>&lt;<span style="color: #2b91af;">DatedItem</span>&gt; copy = StoredData;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> index = copy.FindIndex(<span style="color: blue;">delegate</span>(<span style="color: #2b91af;">DatedItem</span> d) { <span style="color: blue;">return</span> (d.Id == key); });<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (index != -1)<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; copy[index].Date = <span style="color: #2b91af;">DateTime</span>.Now;<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; StoredData = copy;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
<span style="color: blue;">&nbsp;&nbsp;&nbsp; #region</span> For reference- same code for DataTable<br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//private static DataTable LoadDatedItems()</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//{</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; List&lt;DatedItem&gt; items = new List&lt;DatedItem&gt;();</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; 30; i++)</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; {</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DatedItem di = new DatedItem();</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; di.Date = DateTime.Now.AddDays(-i);</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; di.Id = i;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; di.Name = di.Date.ToString("MMMM dd");</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; items.Add(di);</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; }</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; DataTable dt = new DataTable("DatedItems");</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; dt.Columns.Add("name"); dt.Columns.Add("id", typeof(int)); dt.Columns.Add("date", typeof(DateTime));</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; foreach (DatedItem item in items)</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; dt.Rows.Add(item.Name, item.Id, item.Date);</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; return dt;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//}</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//private void SortData()</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//{</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; StoredData.DefaultView.Sort = GridViewSortBy + (GridViewSortAscending ? " ASC" : " DESC");</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//}</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//private DataTable StoredData</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//{</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; get { return ViewState["StoredData"] as DataTable ?? LoadDatedItems(); }</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; set { ViewState["StoredData"] = value; }</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//}</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//private void GetDataFromTemplatedRow(GridView gv, int rowIndex, Control row)</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//{&nbsp;&nbsp; //you MUST use templated columns (you should anyway to validate), so use FindControl</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; string name = GetTextBoxText(row, "txtName");</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; string date = GetTextBoxText(row, "txtDate");</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; int key = (int)gv.DataKeys[rowIndex][0];</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; DataRow datarow = FindDataRow(key);</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; if (datarow != null)</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; {</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; datarow["Name"] = name;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; datarow["Date"] = date;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; }</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//}</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//private DataRow FindDataRow(int key)</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//{</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; DataRow[] rows = StoredData.Select("[id]='" + key + "'");</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; if (rows.Length != 0) return rows[0];</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; else return null;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//}</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//private void GetDataFromEventArgs(GridViewUpdateEventArgs e)</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//{</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; if (e.Keys.Count &gt; 0)</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; {</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; int key = (int)e.Keys[0]; //if using DataKeys</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; DataRow datarow = FindDataRow(key);</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if (datarow != null)</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; datarow["Name"] = e.NewValues["Name"];</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; }</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//}</span><br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//private void SetDateToToday(int key)</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//{</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; DataRow row= FindDataRow(key);</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//&nbsp;&nbsp;&nbsp; row["Date"] = DateTime.Now;</span><br />
&nbsp;&nbsp;&nbsp; <span style="color: green;">//}</span><br />
<span style="color: blue;">&nbsp;&nbsp;&nbsp; #endregion</span><br />
&nbsp;<br />
<span style="color: blue;">&nbsp;&nbsp;&nbsp; #endregion</span><br />
&nbsp;<br />
&nbsp;<br />
}<br />
&nbsp;<br />
<span style="color: green;">//poco must be serializable so we can store it</span><br />
[<span style="color: #2b91af;">Serializable</span>]<br />
<span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">DatedItem</span><br />
{<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: #2b91af;">DateTime</span> _date;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">int</span> _id;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">string</span> _name;<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: #2b91af;">DateTime</span> Date<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> _date; }<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">set</span> { _date = <span style="color: blue;">value</span>; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">int</span> Id<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> _id; }<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">set</span> { _id = <span style="color: blue;">value</span>; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">string</span> Name<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> _name; }<br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">set</span> { _name = <span style="color: blue;">value</span>; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}</p>
</div>


</div>
<div class="Footer">

</div>
</body>
</html>
