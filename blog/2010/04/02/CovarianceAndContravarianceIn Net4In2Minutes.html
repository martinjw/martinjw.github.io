<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>covariance and contravariance in .net 4 in 2 minutes</title>
<link rel="stylesheet" type="text/css" href="../../../../style.css" />
<script type="text/javascript" src="../../../../utilities.js">
</script>
</head>
<body>
<h1>static void</h1>
<div class="menu">
<ul>
<li><a href="../../../../index.html">About</a></li>
<li><a href="../../../index.html">Blog</a></li>
</ul>
</div>
<div class="content">
<h2>covariance and contravariance in .net 4 in 2 minutes</h2>
<p>Published Friday 02 April 2010</p><article>
"<b>Covariance</b>" = specified or MORE derived type<br />
<br />
So upcasting to a more basic class in polymorphism is covariant.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;"><span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;"><br />
object</span> s <span style="color: Red; background-color: Transparent; font-family: Courier New; font-size: 11px;">=</span> <span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">new</span> <span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">string</span>('a', 3);</span><br />
<br />
But you couldn't do it for IEnumerables, even though it seemed safe. Well, now in .net 4 you can.<span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;"><br />
<br />
IList&lt;<span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">string</span>&gt; stringList <span style="color: Red; background-color: Transparent; font-family: Courier New; font-size: 11px;">=</span> <span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">new</span> List&lt;<span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">string</span>&gt;();
            <span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;">//will not compile in .net 1-3, but does in net 4</span>
            IEnumerable&lt;<span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">object</span>&gt; objectList <span style="color: Red; background-color: Transparent; font-family: Courier New; font-size: 11px;">=</span> stringList;</span>Trivia: since .net 1, arrays were covariant.<br />
<pre><span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;"><span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">object</span>[] data <span style="color: Red; background-color: Transparent; font-family: Courier New; font-size: 11px;">=</span> <span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">new</span> <span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">string</span>[3];<br />
data[0] <span style="color: Red; background-color: Transparent; font-family: Courier New; font-size: 11px;">=</span> <span style="color: rgb(102, 102, 102); background-color: rgb(228, 228, 228); font-family: Courier New; font-size: 11px;">"s"</span>;<br />
<span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;"></span></span><span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;">data[0] <span style="color: Red; background-color: Transparent; font-family: Courier New; font-size: 11px;">=</span> </span><span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;"><span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;">1</span></span><span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;">;</span><span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;"><span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;"> //no compiler error- just a runtime ArrayTypeMismatchException</span></span></pre>Now IEnumerable&lt;T&gt; and IQueryable&lt;T&gt; are covariant.<br />
<br />
<pre><span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;"><span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;"><pre><span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;">IList&lt;Cat&gt; cats <span style="color: Red; background-color: Transparent; font-family: Courier New; font-size: 11px;">=</span> <span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">new</span> List&lt;Cat&gt;();<br />
<span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;">//you can cast to IEnumerable (or IQueryable)</span><br />
IEnumerable&lt;Animal&gt; pets <span style="color: Red; background-color: Transparent; font-family: Courier New; font-size: 11px;">=</span> cats;<br />
<span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;">//but you cannot cast to the read-write classes</span><br />
<span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;">//IList&lt;Animal&gt; animals = cats; //compiler error</span></span></pre></span></span></pre>Covariant interfaces must be read-only (and not value types).<br />
<br />
<b>Contravariance </b>= specified or LESS derived type <br />
&nbsp;<br />
<pre><span style="color: Black; background-color: Transparent; font-family: Courier New; font-size: 11px;">var cats <span style="color: Red; background-color: Transparent; font-family: Courier New; font-size: 11px;">=</span> <span style="color: Blue; background-color: Transparent; font-family: Courier New; font-size: 11px;">new</span> List&lt;Cat&gt;();
<span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;">//predicate is contravariant</span>
cats.Find(HasFur); <span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;">//private static bool HasFur(Animal animal)</span>
<span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;">//so is IComparable</span>
cats.Sort(SortByName); <span style="color: Green; background-color: Transparent; font-family: Courier New; font-size: 11px;">//private static int SortByName(Animal x, Animal y)</span></span></pre><br />

<p></p>
</article>
<ul class="seeAlso">
<li><a href="../../../2010/06/06/SmartPasteIn2010.html">Smart Paste in 2010</a> (06 Jun 2010)</li>
<li><a href="../../../2010/11/01/DatabaseSchemaReader.html">Database Schema Reader</a> (01 Nov 2010)</li>
<li><a href="../../../2011/04/07/PublishAndTransformInMsbuildScript.html">Publish and Transform in MSBuild script</a> (07 Apr 2011)</li>
<li><a href="../../../2011/04/09/DatabaseSchemaReaderNowWithExtraSqlite.html">Database Schema Reader now with extra SQLite</a> (09 Apr 2011)</li>
<li><a href="../../../2011/05/02/IldasmAndIlasmToSignAnUnsignedAssembly.html">ildasm and ilasm to sign an unsigned assembly</a> (02 May 2011)</li>
<li><a href="../../../2011/06/10/T4Preprocessing.html">T4 preprocessing</a> (10 Jun 2011)</li>
<li><a href="../../../2011/07/08/Net4 0Caching-NotJustForAsp.html">.Net 4.0 Caching - not just for Asp</a> (08 Jul 2011)</li>
<li><a href="../../../2011/12/10/MCPDWebDeveloper Net4.html">MCPD Web Developer .Net 4</a> (10 Dec 2011)</li>
<li><a href="../../../2012/02/05/EFCodeFirstManyToManyMapping.html">EF Code First Many to Many Mapping</a> (05 Feb 2012)</li>
<li><a href="../../../2012/02/14/EFCodeFirstTracing-LoggingTheSQL.html">EF Code First tracing - logging the SQL</a> (14 Feb 2012)</li>
<li><a href="../../../2012/02/22/EFCodeFirst-ReferencesVsValidation.html">EF Code First - references vs validation</a> (22 Feb 2012)</li>
<li><a href="../../../2013/05/31/WebapiUpdated30May2013.html">WebAPI updated 30 May 2013</a> (31 May 2013)</li>
<li><a href="../../../2013/08/08/TheJSONRequestWasTooLargeToBeDeserialized .html">The JSON request was too large to be deserialized.</a> (08 Aug 2013)</li>
<li><a href="../../../2014/03/07/FormsAuthenticationWithClaims.html">Forms Authentication with claims</a> (07 Mar 2014)</li>
<li><a href="../../../2014/07/23/NetVersioning.html">.Net Versioning</a> (23 Jul 2014)</li>
</ul>
<p>Previously: <a href="../../../2010/03/31/MicrosoftTechdaysRoundup.html">Microsoft TechDays roundup</a> (31 Mar 2010)</p>
</div>
<div class="Footer">

</div>
</body>
</html>